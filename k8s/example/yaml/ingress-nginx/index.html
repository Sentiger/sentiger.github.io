<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.46" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="http://blog.sentiger.com/k8s/example/yaml/ingress-nginx/"><meta property="og:site_name" content="不完全记忆"><meta property="og:title" content="ingress-nginx"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-06-23T15:32:53.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:modified_time" content="2022-06-23T15:32:53.000Z"><title>ingress-nginx | 不完全记忆</title><meta name="description" content="bolg，k8s，go，grpc">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.33f62c06.css">
    <link rel="modulepreload" href="/assets/app.4070a6ab.js"><link rel="modulepreload" href="/assets/index.html.5c77fc79.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/index.html.6e069e51.js"><link rel="prefetch" href="/assets/index.html.9d63f2ae.js"><link rel="prefetch" href="/assets/home.html.d078b815.js"><link rel="prefetch" href="/assets/slide.html.2cbdb642.js"><link rel="prefetch" href="/assets/01-channel关闭.html.4c31eb65.js"><link rel="prefetch" href="/assets/02-进制.html.c46ab3ec.js"><link rel="prefetch" href="/assets/03-epoll.html.190bf09b.js"><link rel="prefetch" href="/assets/04-proxy.html.aa781ad8.js"><link rel="prefetch" href="/assets/05-代理.html.863dd723.js"><link rel="prefetch" href="/assets/index.html.06156dc8.js"><link rel="prefetch" href="/assets/index.html.656b3116.js"><link rel="prefetch" href="/assets/index.html.a94e4123.js"><link rel="prefetch" href="/assets/01-character.html.3bc13882.js"><link rel="prefetch" href="/assets/02-row.html.06f3898b.js"><link rel="prefetch" href="/assets/03-innodb-page.html.a3570d62.js"><link rel="prefetch" href="/assets/04-innodb-表结构和单表查询类型.html.e2c46a25.js"><link rel="prefetch" href="/assets/05-连接查询.html.db8e9d17.js"><link rel="prefetch" href="/assets/06-统计表.html.5725e5e1.js"><link rel="prefetch" href="/assets/07-子查询.html.0ede90fd.js"><link rel="prefetch" href="/assets/08-explain.html.518f377e.js"><link rel="prefetch" href="/assets/09-bufferpool.html.ac058fcf.js"><link rel="prefetch" href="/assets/10-事物.html.7a955ac9.js"><link rel="prefetch" href="/assets/100-自建MySql及优化.html.5715204c.js"><link rel="prefetch" href="/assets/11-redo日志.html.811a5f0e.js"><link rel="prefetch" href="/assets/index.html.cf9fbaa5.js"><link rel="prefetch" href="/assets/01-go连接php-fpm.html.89a1eb02.js"><link rel="prefetch" href="/assets/02-openssl.html.29a171f4.js"><link rel="prefetch" href="/assets/03-git.html.ddef787e.js"><link rel="prefetch" href="/assets/04-nginx-tcp.html.6f6eeef6.js"><link rel="prefetch" href="/assets/05-http.html.dbd616fa.js"><link rel="prefetch" href="/assets/06-三剑客.html.b96c3572.js"><link rel="prefetch" href="/assets/10-mac环境重装.html.1ca985bc.js"><link rel="prefetch" href="/assets/12-公司环境迁移.html.a112d475.js"><link rel="prefetch" href="/assets/20-单词积累.html.518c8d50.js"><link rel="prefetch" href="/assets/22-协议.html.544ff227.js"><link rel="prefetch" href="/assets/index.html.4dbef015.js"><link rel="prefetch" href="/assets/index.html.248afb0f.js"><link rel="prefetch" href="/assets/01-introduction.html.2946ae26.js"><link rel="prefetch" href="/assets/02-一元.html.d9017f95.js"><link rel="prefetch" href="/assets/03-服务端流.html.53ad32ea.js"><link rel="prefetch" href="/assets/04-客户端流.html.e93ce014.js"><link rel="prefetch" href="/assets/index.html.74e0f5b2.js"><link rel="prefetch" href="/assets/01-start.html.cf8e98b6.js"><link rel="prefetch" href="/assets/02-filter-chains.html.d2804eb1.js"><link rel="prefetch" href="/assets/03-fornt-https.html.2a168eea.js"><link rel="prefetch" href="/assets/index.html.3765bfe5.js"><link rel="prefetch" href="/assets/01-简单CICD.html.f9dd27ce.js"><link rel="prefetch" href="/assets/02-kube-proxy模拟.html.e2e7149b.js"><link rel="prefetch" href="/assets/10-pod的一些常用场景.html.5a5b87de.js"><link rel="prefetch" href="/assets/20-etcd-cluster.html.9eb73f27.js"><link rel="prefetch" href="/assets/index.html.f6eebac2.js"><link rel="prefetch" href="/assets/01-pod.html.1909b16d.js"><link rel="prefetch" href="/assets/02-deployment-rs.html.3c040a10.js"><link rel="prefetch" href="/assets/03-service.html.0972189e.js"><link rel="prefetch" href="/assets/10-api-auth.html.dee61e58.js"><link rel="prefetch" href="/assets/11-istio.html.dc3815a9.js"><link rel="prefetch" href="/assets/12-istio-bookinfo.html.1abd2f8f.js"><link rel="prefetch" href="/assets/index.html.2e464ac1.js"><link rel="prefetch" href="/assets/01-重要目录.html.d861941d.js"><link rel="prefetch" href="/assets/02-标准输出入错误.html.db1d2d71.js"><link rel="prefetch" href="/assets/03-iptables-案例.html.9f36e0c1.js"><link rel="prefetch" href="/assets/03-iptables.html.7ee7f1e3.js"><link rel="prefetch" href="/assets/03-ipvs.html.3dd49f81.js"><link rel="prefetch" href="/assets/04-磁盘存储概述.html.f3b6e66c.js"><link rel="prefetch" href="/assets/05-内存理解.html.0fc73892.js"><link rel="prefetch" href="/assets/06-虚拟IP.html.4e0f1268.js"><link rel="prefetch" href="/assets/07-route.html.19475fca.js"><link rel="prefetch" href="/assets/10-lvs.html.97b1f29f.js"><link rel="prefetch" href="/assets/index.html.96ad4ef3.js"><link rel="prefetch" href="/assets/01-青云环境.html.89f9395e.js"><link rel="prefetch" href="/assets/index.html.42c40dc0.js"><link rel="prefetch" href="/assets/01-docker自定义网络.html.4e5a4475.js"><link rel="prefetch" href="/assets/02-局域网内访问docker容器.html.eda3d946.js"><link rel="prefetch" href="/assets/03-docker大二层网络通信.html.d9693bb5.js"><link rel="prefetch" href="/assets/04-vxlan应用.html.7fbf398c.js"><link rel="prefetch" href="/assets/05-flannel-docker.html.adc9eb35.js"><link rel="prefetch" href="/assets/06-flannel-vxlan.html.0a1350a4.js"><link rel="prefetch" href="/assets/10-docker安装.html.07e94317.js"><link rel="prefetch" href="/assets/11-k8s安装-kubeadm.html.a37b8682.js"><link rel="prefetch" href="/assets/12-k8s-1-24-安装-kubeadm.html.120cd048.js"><link rel="prefetch" href="/assets/20-OCI-CRI.html.36d28846.js"><link rel="prefetch" href="/assets/21-CNI.html.0330d3c2.js"><link rel="prefetch" href="/assets/30-protocol.html.73be4944.js"><link rel="prefetch" href="/assets/index.html.c936ca97.js"><link rel="prefetch" href="/assets/CHANGELOG.html.2f5d63c4.js"><link rel="prefetch" href="/assets/404.html.a181930b.js"><link rel="prefetch" href="/assets/index.html.9a2d1655.js"><link rel="prefetch" href="/assets/index.html.9aa058e3.js"><link rel="prefetch" href="/assets/index.html.5b7241d1.js"><link rel="prefetch" href="/assets/index.html.d1db442b.js"><link rel="prefetch" href="/assets/index.html.af831944.js"><link rel="prefetch" href="/assets/index.html.6bcc2d59.js"><link rel="prefetch" href="/assets/index.html.d1549ca7.js"><link rel="prefetch" href="/assets/index.html.40467ea7.js"><link rel="prefetch" href="/assets/index.html.0054ca09.js"><link rel="prefetch" href="/assets/index.html.73862930.js"><link rel="prefetch" href="/assets/index.html.6f0ddba0.js"><link rel="prefetch" href="/assets/index.html.b41553e3.js"><link rel="prefetch" href="/assets/index.html.365be6ed.js"><link rel="prefetch" href="/assets/index.html.20ab2531.js"><link rel="prefetch" href="/assets/index.html.754c2634.js"><link rel="prefetch" href="/assets/index.html.ad5db212.js"><link rel="prefetch" href="/assets/index.html.159242a1.js"><link rel="prefetch" href="/assets/index.html.5b971f05.js"><link rel="prefetch" href="/assets/index.html.4de3a7cb.js"><link rel="prefetch" href="/assets/index.html.ffba8c0b.js"><link rel="prefetch" href="/assets/index.html.ec40b74e.js"><link rel="prefetch" href="/assets/index.html.94b432ec.js"><link rel="prefetch" href="/assets/index.html.3c799900.js"><link rel="prefetch" href="/assets/index.html.165d9100.js"><link rel="prefetch" href="/assets/index.html.fb98d79f.js"><link rel="prefetch" href="/assets/index.html.6ea5a337.js"><link rel="prefetch" href="/assets/index.html.1bb3755c.js"><link rel="prefetch" href="/assets/index.html.b79d2513.js"><link rel="prefetch" href="/assets/index.html.47da985f.js"><link rel="prefetch" href="/assets/index.html.5310b35a.js"><link rel="prefetch" href="/assets/index.html.db1578cf.js"><link rel="prefetch" href="/assets/index.html.68b289a4.js"><link rel="prefetch" href="/assets/index.html.75e84d0b.js"><link rel="prefetch" href="/assets/index.html.f5179afd.js"><link rel="prefetch" href="/assets/index.html.19352056.js"><link rel="prefetch" href="/assets/home.html.6e6aa909.js"><link rel="prefetch" href="/assets/slide.html.20079018.js"><link rel="prefetch" href="/assets/01-channel关闭.html.62e1ef9f.js"><link rel="prefetch" href="/assets/02-进制.html.fac5bcd2.js"><link rel="prefetch" href="/assets/03-epoll.html.d0a89144.js"><link rel="prefetch" href="/assets/04-proxy.html.71a8815c.js"><link rel="prefetch" href="/assets/05-代理.html.7afaee6c.js"><link rel="prefetch" href="/assets/index.html.8bc19f42.js"><link rel="prefetch" href="/assets/index.html.6c63a389.js"><link rel="prefetch" href="/assets/index.html.3ec98102.js"><link rel="prefetch" href="/assets/01-character.html.221bfa2e.js"><link rel="prefetch" href="/assets/02-row.html.cac0ee0b.js"><link rel="prefetch" href="/assets/03-innodb-page.html.787c0824.js"><link rel="prefetch" href="/assets/04-innodb-表结构和单表查询类型.html.65bfb53a.js"><link rel="prefetch" href="/assets/05-连接查询.html.6d27a0c9.js"><link rel="prefetch" href="/assets/06-统计表.html.1ddbd697.js"><link rel="prefetch" href="/assets/07-子查询.html.27cdf06f.js"><link rel="prefetch" href="/assets/08-explain.html.410cfde8.js"><link rel="prefetch" href="/assets/09-bufferpool.html.4c65426a.js"><link rel="prefetch" href="/assets/10-事物.html.3d1d1dc1.js"><link rel="prefetch" href="/assets/100-自建MySql及优化.html.b1aec4f7.js"><link rel="prefetch" href="/assets/11-redo日志.html.a6f4203a.js"><link rel="prefetch" href="/assets/index.html.2af5ca1e.js"><link rel="prefetch" href="/assets/01-go连接php-fpm.html.042b494e.js"><link rel="prefetch" href="/assets/02-openssl.html.f0fffc7e.js"><link rel="prefetch" href="/assets/03-git.html.d6a9c0a3.js"><link rel="prefetch" href="/assets/04-nginx-tcp.html.f806e4d9.js"><link rel="prefetch" href="/assets/05-http.html.96957922.js"><link rel="prefetch" href="/assets/06-三剑客.html.13969e33.js"><link rel="prefetch" href="/assets/10-mac环境重装.html.7f73f2f7.js"><link rel="prefetch" href="/assets/12-公司环境迁移.html.930e98b8.js"><link rel="prefetch" href="/assets/20-单词积累.html.f26b3626.js"><link rel="prefetch" href="/assets/22-协议.html.c4514c0f.js"><link rel="prefetch" href="/assets/index.html.6bf3a9c0.js"><link rel="prefetch" href="/assets/index.html.8cfbfe1e.js"><link rel="prefetch" href="/assets/01-introduction.html.02502d99.js"><link rel="prefetch" href="/assets/02-一元.html.b03787fd.js"><link rel="prefetch" href="/assets/03-服务端流.html.6d1ce1f9.js"><link rel="prefetch" href="/assets/04-客户端流.html.93d29673.js"><link rel="prefetch" href="/assets/index.html.6a8f1107.js"><link rel="prefetch" href="/assets/01-start.html.cfb8dbc6.js"><link rel="prefetch" href="/assets/02-filter-chains.html.08a5e4ed.js"><link rel="prefetch" href="/assets/03-fornt-https.html.b0e4141a.js"><link rel="prefetch" href="/assets/index.html.ba726f84.js"><link rel="prefetch" href="/assets/01-简单CICD.html.28868166.js"><link rel="prefetch" href="/assets/02-kube-proxy模拟.html.f7a100a3.js"><link rel="prefetch" href="/assets/10-pod的一些常用场景.html.4d9d289c.js"><link rel="prefetch" href="/assets/20-etcd-cluster.html.b014f690.js"><link rel="prefetch" href="/assets/index.html.24e1c78c.js"><link rel="prefetch" href="/assets/01-pod.html.b03b8559.js"><link rel="prefetch" href="/assets/02-deployment-rs.html.7dfc572e.js"><link rel="prefetch" href="/assets/03-service.html.6e9fea8c.js"><link rel="prefetch" href="/assets/10-api-auth.html.06f2c5eb.js"><link rel="prefetch" href="/assets/11-istio.html.692606b0.js"><link rel="prefetch" href="/assets/12-istio-bookinfo.html.5554554c.js"><link rel="prefetch" href="/assets/index.html.8ebf8682.js"><link rel="prefetch" href="/assets/01-重要目录.html.767377d3.js"><link rel="prefetch" href="/assets/02-标准输出入错误.html.b032c289.js"><link rel="prefetch" href="/assets/03-iptables-案例.html.4152f02c.js"><link rel="prefetch" href="/assets/03-iptables.html.2f26dd60.js"><link rel="prefetch" href="/assets/03-ipvs.html.608d82a4.js"><link rel="prefetch" href="/assets/04-磁盘存储概述.html.94df6668.js"><link rel="prefetch" href="/assets/05-内存理解.html.a6a76e56.js"><link rel="prefetch" href="/assets/06-虚拟IP.html.9189b96c.js"><link rel="prefetch" href="/assets/07-route.html.bf879972.js"><link rel="prefetch" href="/assets/10-lvs.html.1fbfb640.js"><link rel="prefetch" href="/assets/index.html.7c12c3fc.js"><link rel="prefetch" href="/assets/01-青云环境.html.ff82d26d.js"><link rel="prefetch" href="/assets/index.html.c440ce12.js"><link rel="prefetch" href="/assets/01-docker自定义网络.html.30b4b19a.js"><link rel="prefetch" href="/assets/02-局域网内访问docker容器.html.bfcc0250.js"><link rel="prefetch" href="/assets/03-docker大二层网络通信.html.e4385381.js"><link rel="prefetch" href="/assets/04-vxlan应用.html.d3ee7428.js"><link rel="prefetch" href="/assets/05-flannel-docker.html.1e5e1222.js"><link rel="prefetch" href="/assets/06-flannel-vxlan.html.79865ddf.js"><link rel="prefetch" href="/assets/10-docker安装.html.7c3a5d3b.js"><link rel="prefetch" href="/assets/11-k8s安装-kubeadm.html.e30f3c5e.js"><link rel="prefetch" href="/assets/12-k8s-1-24-安装-kubeadm.html.7c38906f.js"><link rel="prefetch" href="/assets/20-OCI-CRI.html.62fc64d6.js"><link rel="prefetch" href="/assets/21-CNI.html.3575be65.js"><link rel="prefetch" href="/assets/30-protocol.html.bddc77ce.js"><link rel="prefetch" href="/assets/index.html.9a8f5bf3.js"><link rel="prefetch" href="/assets/CHANGELOG.html.de45e3cf.js"><link rel="prefetch" href="/assets/404.html.973a137a.js"><link rel="prefetch" href="/assets/index.html.00e45014.js"><link rel="prefetch" href="/assets/index.html.60c2c2d5.js"><link rel="prefetch" href="/assets/index.html.96a95ed1.js"><link rel="prefetch" href="/assets/index.html.b08b65aa.js"><link rel="prefetch" href="/assets/index.html.8fb487b7.js"><link rel="prefetch" href="/assets/index.html.01e8538f.js"><link rel="prefetch" href="/assets/index.html.051ccd39.js"><link rel="prefetch" href="/assets/index.html.85b1bf1c.js"><link rel="prefetch" href="/assets/index.html.29ea3a78.js"><link rel="prefetch" href="/assets/index.html.cdd279ad.js"><link rel="prefetch" href="/assets/index.html.9c9586cc.js"><link rel="prefetch" href="/assets/index.html.b21082f1.js"><link rel="prefetch" href="/assets/index.html.3e6609b9.js"><link rel="prefetch" href="/assets/index.html.5d93eb64.js"><link rel="prefetch" href="/assets/index.html.b04466ba.js"><link rel="prefetch" href="/assets/index.html.d6962175.js"><link rel="prefetch" href="/assets/index.html.e58be65a.js"><link rel="prefetch" href="/assets/index.html.d6b8ea70.js"><link rel="prefetch" href="/assets/index.html.a212f10a.js"><link rel="prefetch" href="/assets/index.html.f19efabb.js"><link rel="prefetch" href="/assets/index.html.a8ecd93c.js"><link rel="prefetch" href="/assets/index.html.751fa64c.js"><link rel="prefetch" href="/assets/index.html.2d201cfa.js"><link rel="prefetch" href="/assets/index.html.93da3e61.js"><link rel="prefetch" href="/assets/index.html.4d3155d8.js"><link rel="prefetch" href="/assets/index.html.83e28d71.js"><link rel="prefetch" href="/assets/index.html.6d3ea61c.js"><link rel="prefetch" href="/assets/index.html.3f065a39.js"><link rel="prefetch" href="/assets/index.html.f831562f.js"><link rel="prefetch" href="/assets/index.html.4a51ef1a.js"><link rel="prefetch" href="/assets/index.html.92c293e2.js"><link rel="prefetch" href="/assets/index.html.e35ea4ae.js"><link rel="prefetch" href="/assets/index.html.c2a3e287.js"><link rel="prefetch" href="/assets/index.html.afba4c27.js"><link rel="prefetch" href="/assets/404.451390a4.js"><link rel="prefetch" href="/assets/Layout.2f59471f.js"><link rel="prefetch" href="/assets/Slide.25099092.js"><link rel="prefetch" href="/assets/Blog.fae03245.js"><link rel="prefetch" href="/assets/auto.esm.36809f22.js"><link rel="prefetch" href="/assets/index.308e684a.js"><link rel="prefetch" href="/assets/index.1842ee54.js"><link rel="prefetch" href="/assets/mermaid.esm.min.95aabeb7.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.92018b73.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><a href="/" class="home-link"><img class="logo" src="/logo.jpeg" alt="不完全记忆"><!----><span class="site-name hide-in-pad">不完全记忆</span><!--[--><!----><!--]--></a><nav class="nav-links" style=""><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="主页"><span class="icon iconfont icon-home" style=""></span>主页<!----></a></div><div class="nav-item hide-in-mobile"><a href="/grpc/" class="nav-link" aria-label="gRPC"><span class="icon iconfont icon-api" style=""></span>gRPC<!----></a></div><div class="nav-item hide-in-mobile"><a href="/k8s/" class="nav-link active" aria-label="k8s"><span class="icon iconfont icon-class" style=""></span>k8s<!----></a></div><div class="nav-item hide-in-mobile"><a href="/go/" class="nav-link" aria-label="Golang"><span class="icon iconfont icon-code" style=""></span>Golang<!----></a></div><div class="nav-item hide-in-mobile"><a href="/mysql/" class="nav-link" aria-label="MySQL"><span class="icon iconfont icon-mysql" style=""></span>MySQL<!----></a></div><div class="nav-item hide-in-mobile"><a href="/other/" class="nav-link" aria-label="杂项"><span class="icon iconfont icon-box" style=""></span>杂项<!----></a></div></nav><div class="nav-actions-wrapper"><!--[--><!----><!--]--><div class="nav-item"><!----></div><div class="nav-item"><a class="repo-link" href="https://github.com/sentiger/sentiger.github.io" target="_blank" rel="noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button><!--[--><!----><!--]--></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linux" style=""></span><span class="title">Linux</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-list" style=""></span><span class="title">教程</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-expansion" style=""></span><span class="title">配套扩展</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-creative" style=""></span><span class="title">杂项</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-creative" style=""></span><span class="title">envoy</span><span class="arrow right"></span></button><!----></section><!--]--></li><li><!--[--><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-list" style=""></span><span class="title">示例</span><span class="arrow right"></span></button><!----></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->ingress-nginx</h1><div class="page-info"><!----><span class="date-info" aria-label="写作日期" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022年6月23日</span><meta property="datePublished" content="2022-06-23T15:32:53.000Z"></span><!----><!----></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">此页内容</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#prerequisites" class="router-link-active router-link-exact-active toc-link level2">Prerequisites</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#get-repo-info" class="router-link-active router-link-exact-active toc-link level2">Get Repo Info</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#install-chart" class="router-link-active router-link-exact-active toc-link level2">Install Chart</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#uninstall-chart" class="router-link-active router-link-exact-active toc-link level2">Uninstall Chart</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#upgrading-chart" class="router-link-active router-link-exact-active toc-link level2">Upgrading Chart</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#upgrading-with-zero-downtime-in-production" class="router-link-active router-link-exact-active toc-link level3">Upgrading With Zero Downtime in Production</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#migrating-from-stable-nginx-ingress" class="router-link-active router-link-exact-active toc-link level3">Migrating from stable/nginx-ingress</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#configuration" class="router-link-active router-link-exact-active toc-link level2">Configuration</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#poddisruptionbudget" class="router-link-active router-link-exact-active toc-link level3">PodDisruptionBudget</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#prometheus-metrics" class="router-link-active router-link-exact-active toc-link level3">Prometheus Metrics</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#ingress-nginx-nginx-status-page-stats-server" class="router-link-active router-link-exact-active toc-link level3">ingress-nginx nginx_status page/stats server</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#externaldns-service-configuration" class="router-link-active router-link-exact-active toc-link level3">ExternalDNS Service Configuration</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#aws-l7-elb-with-ssl-termination" class="router-link-active router-link-exact-active toc-link level3">AWS L7 ELB with SSL Termination</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#aws-route53-mapper" class="router-link-active router-link-exact-active toc-link level3">AWS route53-mapper</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#additional-internal-load-balancer" class="router-link-active router-link-exact-active toc-link level3">Additional Internal Load Balancer</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#ingress-admission-webhooks" class="router-link-active router-link-exact-active toc-link level3">Ingress Admission Webhooks</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/k8s/example/yaml/ingress-nginx/#helm-error-when-upgrading-spec-clusterip-invalid-value" class="router-link-active router-link-exact-active toc-link level3">Helm Error When Upgrading: spec.clusterIP: Invalid value: &quot;&quot;</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><div><h1 id="ingress-nginx" tabindex="-1"><a class="header-anchor" href="#ingress-nginx" aria-hidden="true">#</a> ingress-nginx</h1><p><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener noreferrer">ingress-nginx<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> Ingress controller for Kubernetes using NGINX as a reverse proxy and load balancer</p><p>To use, add the <code>kubernetes.io/ingress.class: nginx</code> annotation to your Ingress resources.</p><p>This chart bootstraps an ingress-nginx deployment on a <a href="http://kubernetes.io" target="_blank" rel="noopener noreferrer">Kubernetes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> cluster using the <a href="https://helm.sh" target="_blank" rel="noopener noreferrer">Helm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> package manager.</p><h2 id="prerequisites" tabindex="-1"><a class="header-anchor" href="#prerequisites" aria-hidden="true">#</a> Prerequisites</h2><ul><li>Kubernetes v1.16+</li></ul><h2 id="get-repo-info" tabindex="-1"><a class="header-anchor" href="#get-repo-info" aria-hidden="true">#</a> Get Repo Info</h2><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="install-chart" tabindex="-1"><a class="header-anchor" href="#install-chart" aria-hidden="true">#</a> Install Chart</h2><p><strong>Important:</strong> only helm3 is supported</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>helm install [RELEASE_NAME] ingress-nginx/ingress-nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>The command deploys ingress-nginx on the Kubernetes cluster in the default configuration.</p><p><em>See <a href="#configuration">configuration</a> below.</em></p><p><em>See <a href="https://helm.sh/docs/helm/helm_install/" target="_blank" rel="noopener noreferrer">helm install<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for command documentation.</em></p><h2 id="uninstall-chart" tabindex="-1"><a class="header-anchor" href="#uninstall-chart" aria-hidden="true">#</a> Uninstall Chart</h2><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>helm uninstall [RELEASE_NAME]
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>This removes all the Kubernetes components associated with the chart and deletes the release.</p><p><em>See <a href="https://helm.sh/docs/helm/helm_uninstall/" target="_blank" rel="noopener noreferrer">helm uninstall<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for command documentation.</em></p><h2 id="upgrading-chart" tabindex="-1"><a class="header-anchor" href="#upgrading-chart" aria-hidden="true">#</a> Upgrading Chart</h2><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>helm upgrade [RELEASE_NAME] [CHART] --install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><em>See <a href="https://helm.sh/docs/helm/helm_upgrade/" target="_blank" rel="noopener noreferrer">helm upgrade<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for command documentation.</em></p><h3 id="upgrading-with-zero-downtime-in-production" tabindex="-1"><a class="header-anchor" href="#upgrading-with-zero-downtime-in-production" aria-hidden="true">#</a> Upgrading With Zero Downtime in Production</h3><p>By default the ingress-nginx controller has service interruptions whenever it&#39;s pods are restarted or redeployed. In order to fix that, see the excellent blog post by Lindsay Landry from Codecademy: <a href="https://medium.com/codecademy-engineering/kubernetes-nginx-and-zero-downtime-in-production-2c910c6a5ed8" target="_blank" rel="noopener noreferrer">Kubernetes: Nginx and Zero Downtime in Production<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>.</p><h3 id="migrating-from-stable-nginx-ingress" tabindex="-1"><a class="header-anchor" href="#migrating-from-stable-nginx-ingress" aria-hidden="true">#</a> Migrating from stable/nginx-ingress</h3><p>There are two main ways to migrate a release from <code>stable/nginx-ingress</code> to <code>ingress-nginx/ingress-nginx</code> chart:</p><ol><li>For Nginx Ingress controllers used for non-critical services, the easiest method is to <a href="#uninstall-chart">uninstall</a> the old release and <a href="#install-chart">install</a> the new one</li><li>For critical services in production that require zero-downtime, you will want to: <ol><li><a href="#install-chart">Install</a> a second Ingress controller</li><li>Redirect your DNS traffic from the old controller to the new controller</li><li>Log traffic from both controllers during this changeover</li><li><a href="#uninstall-chart">Uninstall</a> the old controller once traffic has fully drained from it</li><li>For details on all of these steps see <a href="#upgrading-with-zero-downtime-in-production">Upgrading With Zero Downtime in Production</a></li></ol></li></ol><p>Note that there are some different and upgraded configurations between the two charts, described by Rimas Mocevicius from JFrog in the &quot;Upgrading to ingress-nginx Helm chart&quot; section of <a href="https://rimusz.net/migrating-to-ingress-nginx" target="_blank" rel="noopener noreferrer">Migrating from Helm chart nginx-ingress to ingress-nginx<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. As the <code>ingress-nginx/ingress-nginx</code> chart continues to update, you will want to check current differences by running <a href="#configuration">helm configuration</a> commands on both charts.</p><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration" aria-hidden="true">#</a> Configuration</h2><p>See <a href="https://helm.sh/docs/intro/using_helm/#customizing-the-chart-before-installing" target="_blank" rel="noopener noreferrer">Customizing the Chart Before Installing<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>. To see all configurable options with detailed comments, visit the chart&#39;s <a href="./values.yaml">values.yaml</a>, or run these configuration commands:</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>helm show values ingress-nginx/ingress-nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="poddisruptionbudget" tabindex="-1"><a class="header-anchor" href="#poddisruptionbudget" aria-hidden="true">#</a> PodDisruptionBudget</h3><p>Note that the PodDisruptionBudget resource will only be defined if the replicaCount is greater than one, else it would make it impossible to evacuate a node. See <a href="https://github.com/helm/charts/issues/7127" target="_blank" rel="noopener noreferrer">gh issue #7127<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> for more info.</p><h3 id="prometheus-metrics" tabindex="-1"><a class="header-anchor" href="#prometheus-metrics" aria-hidden="true">#</a> Prometheus Metrics</h3><p>The Nginx ingress controller can export Prometheus metrics, by setting <code>controller.metrics.enabled</code> to <code>true</code>.</p><p>You can add Prometheus annotations to the metrics service using <code>controller.metrics.service.annotations</code>. Alternatively, if you use the Prometheus Operator, you can enable ServiceMonitor creation using <code>controller.metrics.serviceMonitor.enabled</code>.</p><h3 id="ingress-nginx-nginx-status-page-stats-server" tabindex="-1"><a class="header-anchor" href="#ingress-nginx-nginx-status-page-stats-server" aria-hidden="true">#</a> ingress-nginx nginx_status page/stats server</h3><p>Previous versions of this chart had a <code>controller.stats.*</code> configuration block, which is now obsolete due to the following changes in nginx ingress controller:</p><ul><li>In <a href="https://github.com/kubernetes/ingress-nginx/blob/main/Changelog.md#0161" target="_blank" rel="noopener noreferrer">0.16.1<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, the vts (virtual host traffic status) dashboard was removed</li><li>In <a href="https://github.com/kubernetes/ingress-nginx/blob/main/Changelog.md#0230" target="_blank" rel="noopener noreferrer">0.23.0<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, the status page at port 18080 is now a unix socket webserver only available at localhost. You can use <code>curl --unix-socket /tmp/nginx-status-server.sock http://localhost/nginx_status</code> inside the controller container to access it locally, or use the snippet from <a href="https://github.com/kubernetes/ingress-nginx/blob/main/Changelog.md#0230" target="_blank" rel="noopener noreferrer">nginx-ingress changelog<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> to re-enable the http server</li></ul><h3 id="externaldns-service-configuration" tabindex="-1"><a class="header-anchor" href="#externaldns-service-configuration" aria-hidden="true">#</a> ExternalDNS Service Configuration</h3><p>Add an <a href="https://github.com/kubernetes-incubator/external-dns" target="_blank" rel="noopener noreferrer">ExternalDNS<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> annotation to the LoadBalancer service:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">external-dns.alpha.kubernetes.io/hostname</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>example.com.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aws-l7-elb-with-ssl-termination" tabindex="-1"><a class="header-anchor" href="#aws-l7-elb-with-ssl-termination" aria-hidden="true">#</a> AWS L7 ELB with SSL Termination</h3><p>Annotate the controller as shown in the <a href="https://github.com/kubernetes/ingress-nginx/blob/main/deploy/aws/l7/service-l7.yaml" target="_blank" rel="noopener noreferrer">nginx-ingress l7 patch<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">targetPorts</span><span class="token punctuation">:</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span> http
      <span class="token key atrule">https</span><span class="token punctuation">:</span> http
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">service.beta.kubernetes.io/aws-load-balancer-ssl-cert</span><span class="token punctuation">:</span> arn<span class="token punctuation">:</span>aws<span class="token punctuation">:</span>acm<span class="token punctuation">:</span>XX<span class="token punctuation">-</span>XXXX<span class="token punctuation">-</span>X<span class="token punctuation">:</span>XXXXXXXXX<span class="token punctuation">:</span>certificate/XXXXXXXX<span class="token punctuation">-</span>XXXX<span class="token punctuation">-</span>XXXX<span class="token punctuation">-</span>XXXX<span class="token punctuation">-</span>XXXXXXXXXX
      <span class="token key atrule">service.beta.kubernetes.io/aws-load-balancer-backend-protocol</span><span class="token punctuation">:</span> <span class="token string">&quot;http&quot;</span>
      <span class="token key atrule">service.beta.kubernetes.io/aws-load-balancer-ssl-ports</span><span class="token punctuation">:</span> <span class="token string">&quot;https&quot;</span>
      <span class="token key atrule">service.beta.kubernetes.io/aws-load-balancer-connection-idle-timeout</span><span class="token punctuation">:</span> <span class="token string">&#39;3600&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="aws-route53-mapper" tabindex="-1"><a class="header-anchor" href="#aws-route53-mapper" aria-hidden="true">#</a> AWS route53-mapper</h3><p>To configure the LoadBalancer service with the <a href="https://github.com/kubernetes/kops/tree/master/addons/route53-mapper" target="_blank" rel="noopener noreferrer">route53-mapper addon<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, add the <code>domainName</code> annotation and <code>dns</code> label:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">labels</span><span class="token punctuation">:</span>
      <span class="token key atrule">dns</span><span class="token punctuation">:</span> <span class="token string">&quot;route53&quot;</span>
    <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
      <span class="token key atrule">domainName</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes-example.com&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="additional-internal-load-balancer" tabindex="-1"><a class="header-anchor" href="#additional-internal-load-balancer" aria-hidden="true">#</a> Additional Internal Load Balancer</h3><p>This setup is useful when you need both external and internal load balancers but don&#39;t want to have multiple ingress controllers and multiple ingress objects per application.</p><p>By default, the ingress object will point to the external load balancer address, but if correctly configured, you can make use of the internal one if the URL you are looking up resolves to the internal load balancer&#39;s URL.</p><p>You&#39;ll need to set both the following values:</p><p><code>controller.service.internal.enabled</code><code>controller.service.internal.annotations</code></p><p>If one of them is missing the internal load balancer will not be deployed. Example you may have <code>controller.service.internal.enabled=true</code> but no annotations set, in this case no action will be taken.</p><p><code>controller.service.internal.annotations</code> varies with the cloud service you&#39;re using.</p><p>Example for AWS:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">internal</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token comment"># Create internal ELB</span>
        <span class="token key atrule">service.beta.kubernetes.io/aws-load-balancer-internal</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token comment"># Any other annotation can be declared here.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example for GCE:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
    <span class="token key atrule">internal</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token comment"># Create internal LB. More informations: https://cloud.google.com/kubernetes-engine/docs/how-to/internal-load-balancing</span>
        <span class="token comment"># For GKE versions 1.17 and later</span>
        <span class="token key atrule">networking.gke.io/load-balancer-type</span><span class="token punctuation">:</span> <span class="token string">&quot;Internal&quot;</span>
        <span class="token comment"># For earlier versions</span>
        <span class="token comment"># cloud.google.com/load-balancer-type: &quot;Internal&quot;</span>
        
        <span class="token comment"># Any other annotation can be declared here. </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example for Azure:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token comment"># Create internal LB</span>
        <span class="token key atrule">service.beta.kubernetes.io/azure-load-balancer-internal</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token comment"># Any other annotation can be declared here.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Example for Oracle Cloud Infrastructure:</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">controller</span><span class="token punctuation">:</span>
  <span class="token key atrule">service</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token comment"># Create internal LB</span>
        <span class="token key atrule">service.beta.kubernetes.io/oci-load-balancer-internal</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token comment"># Any other annotation can be declared here.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>An use case for this scenario is having a split-view DNS setup where the public zone CNAME records point to the external balancer URL while the private zone CNAME records point to the internal balancer URL. This way, you only need one ingress kubernetes object.</p><p>Optionally you can set <code>controller.service.loadBalancerIP</code> if you need a static IP for the resulting <code>LoadBalancer</code>.</p><h3 id="ingress-admission-webhooks" tabindex="-1"><a class="header-anchor" href="#ingress-admission-webhooks" aria-hidden="true">#</a> Ingress Admission Webhooks</h3><p>With nginx-ingress-controller version 0.25+, the nginx ingress controller pod exposes an endpoint that will integrate with the <code>validatingwebhookconfiguration</code> Kubernetes feature to prevent bad ingress from being added to the cluster. <strong>This feature is enabled by default since 0.31.0.</strong></p><p>With nginx-ingress-controller in 0.25.* work only with kubernetes 1.14+, 0.26 fix <a href="https://github.com/kubernetes/ingress-nginx/pull/4521" target="_blank" rel="noopener noreferrer">this issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="helm-error-when-upgrading-spec-clusterip-invalid-value" tabindex="-1"><a class="header-anchor" href="#helm-error-when-upgrading-spec-clusterip-invalid-value" aria-hidden="true">#</a> Helm Error When Upgrading: spec.clusterIP: Invalid value: &quot;&quot;</h3><p>If you are upgrading this chart from a version between 0.31.0 and 1.2.2 then you may get an error like this:</p><div class="language-console ext-console line-numbers-mode"><pre class="language-console"><code>Error: UPGRADE FAILED: Service &quot;?????-controller&quot; is invalid: spec.clusterIP: Invalid value: &quot;&quot;: field is immutable
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Detail of how and why are in <a href="https://github.com/helm/charts/pull/13646" target="_blank" rel="noopener noreferrer">this issue<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> but to resolve this you can set <code>xxxx.service.omitClusterIP</code> to <code>true</code> where <code>xxxx</code> is the service referenced in the error.</p><p>As of version <code>1.26.0</code> of this chart, by simply not providing any clusterIP value, <code>invalid: spec.clusterIP: Invalid value: &quot;&quot;: field is immutable</code> will no longer occur since <code>clusterIP: &quot;&quot;</code> will not be rendered.</p></div></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">上次编辑于: </span><span class="info">2022/6/23 15:32:53</span></div><!----></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"></div><div class="copyright">Copyright © 2022 Sentiger</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.4070a6ab.js" defer></script>
  </body>
</html>
