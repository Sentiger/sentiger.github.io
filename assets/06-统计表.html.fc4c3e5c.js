import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";import{o as n,c as a,e}from"./app.2c7377e3.js";const p={},o=e(`<p>MySQL\u5728\u67E5\u8BE2\u7684\u65F6\u5019\u6709\u4E2A\u4F18\u5316\u5668\u7684\u4E1C\u897F\uFF0C\u53D6\u51B3\u4E8E\u67E5\u8BE2\u7684\u65F6\u5019\u662F\u8D70\u7D22\u5F15\u8FD8\u662F\u5168\u8868\u626B\u63CF\u7B49\u624B\u6BB5\u3002\u6240\u4EE5\u5BF9\u4E8E\u4E00\u4E9B\u8868\u7684\u7EDF\u8BA1\u4FE1\u606F\u5219\u6210\u4E3A\u5173\u952E\uFF0C\u63A5\u4E0B\u6765\u4ECB\u7ECD\u4E0B\u6BCF\u4E2A\u8868\u7684\u7EDF\u8BA1\u4FE1\u606F\uFF1A</p><h2 id="\u7EDF\u8BA1\u8868" tabindex="-1"><a class="header-anchor" href="#\u7EDF\u8BA1\u8868" aria-hidden="true">#</a> \u7EDF\u8BA1\u8868</h2><ol><li>MySQL 5.6\u4E4B\u540E \u9ED8\u8BA4\u5C06\u7EDF\u8BA1\u4FE1\u606F\u5B58\u653E\u5230\u6570\u636E\u8868\u4E2D\uFF0C\u800C\u4E14\u7EDF\u8BA1\u4FE1\u606F\u662F\u4EE5\u8868\u4E3A\u5355\u4F4D</li><li>\u8868\uFF1Amysql.innodb_table_stats</li><li>innodb\u5728\u505A\u8868\u7EDF\u8BA1\u7684\u65F6\u5019\uFF0C\u5927\u81F4\u903B\u8F91\u5C31\u662F\u901A\u8FC7\u4E00\u5B9A\u7B97\u6CD5\u62BD\u9009\u51FAN\u4E2A\u9875\u9762\uFF0C\u7136\u540E\u8BA1\u7B97\u9875\u9762\u8BB0\u5F55\u7684\u5E73\u5C40\u6570\uFF0C\u7136\u540E\u4E58\u4EE5\u53F6\u5B50\u9875\u9762\u7684\u6570\u91CF\u3002\u6240\u4EE5\u5F71\u54CD\u7EDF\u8BA1\u4FE1\u606F\u7684\u57FA\u672C\u548C\u62BD\u6837\u7684\u9875\u9762\u6570\u6709\u5173\u7CFB\uFF0C\u6570\u91CF\u8D8A\u5927\u8D8A\u51C6\u786E\uFF0C\u4F46\u662F\u8D8A\u8017\u65F6\u3002</li><li>\u5982\u679C\u5F00\u542F\u81EA\u52A8\u7EDF\u8BA1\uFF0C\u5219\u4E00\u4E2A\u8868\u4E2D\u8D85\u8FC710%\u7684\u8868\u52A8\uFF0C\u4F1A\u89E6\u53D1\u7EDF\u8BA1\u4EFB\u52A1\uFF0C\u662F\u5F02\u6B65\u7684\u3002</li></ol><div class="language-sql ext-sql line-numbers-mode"><pre class="language-sql"><code>
<span class="token comment"># \u521B\u5EFA\u8868\u7684\u65F6\u5019\uFF0C\u9ED8\u8BA4\u7EDF\u8BA1\u8868\u8BB0\u5F55\u7684\u9875\u9762\u62BD\u6837\u6570\u91CF</span>

<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&quot;innodb_stats_persistent_sample_pages&quot;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+-------+</span>
<span class="token operator">|</span> Variable_name                        <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+-------+</span>
<span class="token operator">|</span> innodb_stats_persistent_sample_pages <span class="token operator">|</span> <span class="token number">20</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------------------+-------+</span>

<span class="token comment"># \u5F00\u542F\u4E86\u81EA\u52A8\u7EDF\u8BA1\uFF0C\uFF0810%\u53D8\u52A8\uFF09</span>

<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">&quot;innodb_stats_auto_recalc&quot;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">--------------------------+-------+</span>
<span class="token operator">|</span> Variable_name            <span class="token operator">|</span> <span class="token keyword">Value</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------+-------+</span>
<span class="token operator">|</span> innodb_stats_auto_recalc <span class="token operator">|</span> <span class="token keyword">ON</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">--------------------------+-------+</span>

<span class="token comment"># \u7EDF\u8BA1\u8868\u4E2D\u7684\u8BB0\u5F55\u6570\u91CF</span>
<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> anbao<span class="token punctuation">.</span>device_mqtt_msg<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>  <span class="token number">4867581</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>

<span class="token comment"># \u67E5\u8BE2\u7EDF\u8BA1\u8868\u7684\u7EDF\u8BA1\u8BB0\u5F55\uFF08\u4F30\u503C\uFF09\u53D1\u73B0\u4E0E\u771F\u5B9E\u6570\u636E\u4E0D\u4E00\u81F4</span>
<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>innodb_table_stats <span class="token keyword">where</span> database_name <span class="token operator">=</span> <span class="token string">&#39;anbao&#39;</span> <span class="token operator">and</span> table_name <span class="token operator">=</span> <span class="token string">&#39;device_mqtt_msg&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+---------------------+---------+----------------------+--------------------------+</span>
<span class="token operator">|</span> database_name <span class="token operator">|</span> table_name      <span class="token operator">|</span> last_update         <span class="token operator">|</span> n_rows  <span class="token operator">|</span> clustered_index_size <span class="token operator">|</span> sum_of_other_index_sizes <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+---------------------+---------+----------------------+--------------------------+</span>
<span class="token operator">|</span> anbao         <span class="token operator">|</span> device_mqtt_msg <span class="token operator">|</span> <span class="token number">2021</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">-</span><span class="token number">22</span> <span class="token number">04</span>:<span class="token number">39</span>:<span class="token number">04</span> <span class="token operator">|</span> <span class="token number">4195737</span> <span class="token operator">|</span>                <span class="token number">30592</span> <span class="token operator">|</span>                    <span class="token number">11196</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+---------------------+---------+----------------------+--------------------------+</span>

<span class="token comment"># \u5C06\u62BD\u8C61\u7684\u9875\u9762\u6570\u8BBE\u7F6E\u6BD4\u8F83\u5927\uFF0C\u5B8C\u5168\u5927\u4E8E30592\uFF0C\u5219\u4F1A\u8FDB\u884C\u5168\u90E8\u9875\u9762\u90FD\u662F\u6837\u672C\u6570\uFF0C\u8FD9\u6837\u6BD4\u8F83\u51C6\u786E</span>
<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span> <span class="token keyword">alter</span> <span class="token keyword">table</span> anbao<span class="token punctuation">.</span>device_mqtt_msg  STATS_SAMPLE_PAGES <span class="token operator">=</span> <span class="token number">40000</span><span class="token punctuation">;</span>

<span class="token comment"># \u624B\u52A8\u89E6\u53D1\u7EDF\u8BA1\uFF08\u540C\u6B65\u4EFB\u52A1\uFF09</span>
<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span> <span class="token keyword">ANALYZE</span> <span class="token keyword">TABLE</span> anbao<span class="token punctuation">.</span>device_mqtt_msg<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">-----------------------+---------+----------+----------+</span>
<span class="token operator">|</span> <span class="token keyword">Table</span>                 <span class="token operator">|</span> Op      <span class="token operator">|</span> Msg_type <span class="token operator">|</span> Msg_text <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+---------+----------+----------+</span>
<span class="token operator">|</span> anbao<span class="token punctuation">.</span>device_mqtt_msg <span class="token operator">|</span> <span class="token keyword">analyze</span> <span class="token operator">|</span> <span class="token keyword">status</span>   <span class="token operator">|</span> OK       <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">-----------------------+---------+----------+----------+</span>
<span class="token number">1</span> <span class="token keyword">row</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">4.89</span> sec<span class="token punctuation">)</span>

<span class="token comment"># \u53D1\u73B0\u8FD9\u6B21\u7ED3\u679C\u548Ccount\u7EDF\u8BA1\u7ED3\u679C\u4E00\u6837\uFF0C\u6BD4\u8F83\u51C6\u786E\u3002</span>
<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> mysql<span class="token punctuation">.</span>innodb_table_stats <span class="token keyword">where</span> database_name <span class="token operator">=</span> <span class="token string">&#39;anbao&#39;</span> <span class="token operator">and</span> table_name <span class="token operator">=</span> <span class="token string">&#39;device_mqtt_msg&#39;</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+---------------------+---------+----------------------+--------------------------+</span>
<span class="token operator">|</span> database_name <span class="token operator">|</span> table_name      <span class="token operator">|</span> last_update         <span class="token operator">|</span> n_rows  <span class="token operator">|</span> clustered_index_size <span class="token operator">|</span> sum_of_other_index_sizes <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+---------------------+---------+----------------------+--------------------------+</span>
<span class="token operator">|</span> anbao         <span class="token operator">|</span> device_mqtt_msg <span class="token operator">|</span> <span class="token number">2022</span><span class="token operator">-</span><span class="token number">07</span><span class="token operator">-</span><span class="token number">14</span> <span class="token number">06</span>:<span class="token number">19</span>:<span class="token number">13</span> <span class="token operator">|</span> <span class="token number">4867581</span> <span class="token operator">|</span>                <span class="token number">32448</span> <span class="token operator">|</span>                    <span class="token number">11903</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------------+-----------------+---------------------+---------+----------------------+--------------------------+</span>

<span class="token punctuation">[</span>root<span class="token variable">@localhost</span><span class="token punctuation">]</span>:mysql<span class="token operator">&gt;</span><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">from</span> anbao<span class="token punctuation">.</span>device_mqtt_msg<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>
<span class="token operator">|</span>  <span class="token number">4867581</span> <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">----------+</span>



 <span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> \u8868\u540D <span class="token keyword">Engine</span><span class="token operator">=</span><span class="token keyword">InnoDB</span><span class="token punctuation">,</span> STATS_AUTO_RECALC <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">|</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),t=[o];function l(c,r){return n(),a("div",null,t)}var u=s(p,[["render",l],["__file","06-\u7EDF\u8BA1\u8868.html.vue"]]);export{u as default};
