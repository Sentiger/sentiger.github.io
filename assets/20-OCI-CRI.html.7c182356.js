import{_ as o}from"./plugin-vue_export-helper.21dcd24c.js";import{r as p,o as c,c as i,a as s,b as t,d as n,e}from"./app.6da40224.js";const u={},l=s("h2",{id:"oci",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#oci","aria-hidden":"true"},"#"),n(" OCI")],-1),r=n("Linux\u652F\u6301\u8FD0\u884C\u5BB9\u5668\uFF0C\u56E0\u6B64\u6BCF\u4E2A\u4EBA\u90FD\u53EF\u4EE5\u5F00\u53D1\u9488\u5BF9\u4E8E\u521B\u5EFA\u5BB9\u5668\u548C\u7BA1\u7406\u5BB9\u5668\u7684\u8F6F\u4EF6\uFF0C\u5BFC\u81F4\u5E02\u9762\u4E0A\u5404\u79CD\u5404\u6837\u7684\u3002\u6240\u4EE5\u9488\u5BF9\u8FD9\u4E2A\u9700\u8981\u505A\u4E00\u4E2A\u89C4\u8303\u3002\u4E5F\u5C31\u662F"),d={href:"https://opencontainers.org",target:"_blank",rel:"noopener noreferrer"},k=n("oci"),v=n("OCI\u603B\u4F53\u89C4\u8303\u4E86\u4E09\u4E2A\u89C4\u8303\uFF0C"),m={href:"https://github.com/opencontainers/runtime-spec",target:"_blank",rel:"noopener noreferrer"},b=n("oci-runtime"),h=n(" , "),g={href:"https://github.com/opencontainers/distribution-spec",target:"_blank",rel:"noopener noreferrer"},_=n("oci-distribution"),f=n(", "),x={href:"https://github.com/opencontainers/image-spec",target:"_blank",rel:"noopener noreferrer"},C=n("oci-image"),q=e('<h3 id="runtime" tabindex="-1"><a class="header-anchor" href="#runtime" aria-hidden="true">#</a> runtime</h3><p>runtime \u89C4\u8303\u4E86\u5982\u4F55\u542F\u52A8\u548C\u7BA1\u7406\u5BB9\u5668\u3002\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7runc \u8FD9\u4E2A\u5B9E\u73B0\u6765\u64CD\u4F5C\u5BB9\u5668</p><h3 id="image" tabindex="-1"><a class="header-anchor" href="#image" aria-hidden="true">#</a> image</h3><p>image\u89C4\u8303\u4E86\u5982\u4F55\u5236\u4F5C\u955C\u50CF</p><h3 id="distribution" tabindex="-1"><a class="header-anchor" href="#distribution" aria-hidden="true">#</a> distribution</h3><p>\u5176\u5B9E\u8FD9\u4E2A\u5B98\u65B9\u6CA1\u6709\u8BF4\u8FD9\u4E5F\u662F\u5176\u4E2D\u7684\u89C4\u8303\u3002\u8FD9\u4E2A\u662F\u7528\u6765\u5982\u4F55\u7BA1\u7406\u5BB9\u5668\u7684\uFF0C\u4F8B\u5982\u642D\u5EFA\u4E2A\u672C\u5730\u5BB9\u5668\u670D\u52A1\uFF0C\u8FD9\u4E2A\u670D\u52A1\u6709\u54EA\u4E9B\u63A5\u53E3\u3002</p><h2 id="cri" tabindex="-1"><a class="header-anchor" href="#cri" aria-hidden="true">#</a> CRI</h2>',7),R={href:"https://github.com/kubernetes/cri-api/blob/c75ef5b/pkg/apis/runtime/v1/api.proto",target:"_blank",rel:"noopener noreferrer"},w=n("cri"),V=n("\u8FD9\u4E2A\u662Fk8s\u5B98\u65B9\u6307\u5B9A\u7684\u4E00\u4E2A\u63A5\u5165\u5BB9\u5668\u7684\u89C4\u8303\u3002\u662F\u4EE5RPC\u63A5\u53E3\u8C03\u7528\uFF0C\u63A5\u4E0B\u6765\u6211\u4EEC\u81EA\u5DF1\u5199GRPC\u5BA2\u6237\u7AEF\u53EF\u4EE5\u8C03\u7528"),I=e(`<p><strong>\u4E0B\u8F7D\u5BA2\u6237\u7AEF</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u4E0B\u8F7DGRPC\u5E93\uFF0C\u4F7F\u7528\u5BA2\u6237\u7AEF\u8C03\u7528</span>
$ go get -u google.golang.org/grpc 
<span class="token comment"># \u8FD9\u4E2A\u8981\u4E0D\u8981\u65E0\u6240\u8C13\uFF0C\u53EF\u76F4\u63A5\u5728 cri \u5B9A\u4E49\u7684proto\u6587\u4EF6\u4E2D\u4E0B\u8F7D\uFF0C\u81EA\u5DF1\u751F\u6210pb.go\u6587\u4EF6\uFF0C\u53EA\u662F\u8FD9\u91CC\u91CC\u9762\u6709\u7ED9\u7F16\u8BD1\u597D\u7684</span>
$ go get -u k8s.io/cri-api
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>\u5BA2\u6237\u7AEF\u8C03\u7528</strong></p><p>\u8C03\u7528containerd\u3002\u56E0\u4E3Acontainerd\u5B9E\u73B0\u4E86CRI\u63A5\u53E3\uFF0C\u6240\u4EE5\u53EF\u4EE5\u76F4\u63A5\u8C03\u7528\uFF0C\u65E0\u9700\u5173\u5FC3containerd\u5B9E\u73B0\u7684\u539F\u7406</p><div class="custom-container danger"><p class="custom-container-title">\u8B66\u544A</p><p>\u8FD9\u5E94\u8BE5\u8C03\u7528\u7684\u7248\u672C\u6839\u636Econtainerd\u7684\u5B9E\u9645\u7248\u672C\u6765\uFF0C\u76EE\u524D\u6709v1\u548Cv1alpha2\u8FD9\u4E24\u4E2A\u7248\u672C\uFF0C\u5177\u4F53\u67E5\u770B\u53EF\u901A\u8FC7</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@web2 runc<span class="token punctuation">]</span><span class="token comment"># crictl version</span>
Version:  <span class="token number">0.1</span>.0
RuntimeName:  containerd
RuntimeVersion:  <span class="token number">1.6</span>.6
RuntimeApiVersion:  v1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><div class="language-go ext-go line-numbers-mode"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	addr <span class="token operator">:=</span> <span class="token string">&quot;unix:///run/containerd/containerd.sock&quot;</span>
	conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span>
		grpc<span class="token punctuation">.</span><span class="token function">WithTransportCredentials</span><span class="token punctuation">(</span>insecure<span class="token punctuation">.</span><span class="token function">NewCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDE\u63A5\u5931\u8D25&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token boolean">_</span> <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

	req <span class="token operator">:=</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>VersionRequest<span class="token punctuation">{</span><span class="token punctuation">}</span>

	service <span class="token operator">:=</span> v1<span class="token punctuation">.</span><span class="token function">NewRuntimeServiceClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
	resp<span class="token punctuation">,</span> err <span class="token operator">:=</span> service<span class="token punctuation">.</span><span class="token function">Version</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// \u6216\u8005\u76F4\u63A5\u8C03\u7528</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	addr <span class="token operator">:=</span> <span class="token string">&quot;unix:///run/containerd/containerd.sock&quot;</span>
	conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span>
		grpc<span class="token punctuation">.</span><span class="token function">WithTransportCredentials</span><span class="token punctuation">(</span>insecure<span class="token punctuation">.</span><span class="token function">NewCredentials</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span><span class="token string">&quot;\u8FDE\u63A5\u5931\u8D25&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token boolean">_</span> <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	req <span class="token operator">:=</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>VersionRequest<span class="token punctuation">{</span><span class="token punctuation">}</span>
	resp <span class="token operator">:=</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">.</span>VersionResponse<span class="token punctuation">{</span><span class="token punctuation">}</span>
	err <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;runtime.v1.RuntimeService/Version&quot;</span><span class="token punctuation">,</span> req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		log<span class="token punctuation">.</span><span class="token function">Fatalln</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6);function y(N,B){const a=p("ExternalLinkIcon");return c(),i("div",null,[l,s("p",null,[r,s("a",d,[k,t(a)])]),s("p",null,[v,s("a",m,[b,t(a)]),h,s("a",g,[_,t(a)]),f,s("a",x,[C,t(a)])]),q,s("p",null,[s("a",R,[w,t(a)]),V]),I])}var O=o(u,[["render",y],["__file","20-OCI-CRI.html.vue"]]);export{O as default};
